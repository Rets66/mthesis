\section{序論}
\subsection{背景}
%APT攻撃のような用意周到に秘匿通信する手法が利用されている背景から入る方がいいのかもしれない．
ドメインネームシステム(Domain Name System, DNS)は，ドメイン名(E.g. www.example.com)をインターネット上でのノードの住所を表すIPアドレス(E.g. 93.184.216.34)に変換する機能を担っており，DNSを通じて特定した宛先に問い合わせることで我々はサービスにアクセスできている．
現在のインターネットの利活用において，名前解決の仕組みは極めて重要な技術の一つである．
しかし，性善説的な当時の設計に伴い生じた脆弱性を利用した攻撃がいくつか報告されている．
1987年にRFC1034, RFC1035~\cite{rfc1034, rfc1035}として公開されたDNSのコンセプトは，現在もなお本質的な仕組みは変更されることなく適用されている．
%近年では，平文であるDNSクエリを解析することでユーザがどのwebページを閲覧しようとしているのか，どこにメールを送信しようとしているのかといったユーザのプライバシーを侵害される脅威\cite{rfc7626}に関心が集まっており，HTTPSやTLSによってクエリおよび応答パケットを暗号化するDoH/DoTが盛んに議論されている．
その設計に起因する課題の内，DNSクエリのラベルおよびリソースレコード(Resource Record, RR)をデータ転送のメディアとするDNS Tunnelingがある．

DNS Tunnelingは，一般にフィルタリングされることが少ないDNSの特徴とDNSがデータ転送のメディアとして機能しているとは想像しない人の認知の隙間をついた手法であり，ファイヤー・ウォールやIDS/IPSといったセキュリティラインを突破するために使用される．
このように本来の目的とは違う方法でデータを転送する手法は，一般に秘匿通信(Covert Channel)と呼ばれる~\cite{covertchannel}．
DNS Tunnelingは，秘匿通信の代表例であり，マルウェアとC2(Command \& Control)サーバとの通信の秘匿手法，または，ターゲットから取得したデータを外部に流出させるといった目的実行の手段として，実際のインシデントで広く利用されている~\cite{frameworkpos, bondupdater, bernhardpos, multigrainpos, pisloader, denis, dnsmessenger, udpos}．
%2014年には，発生した大規模なクレジットカード情報流出事件\cite{}，最近では2019年に発生したAPTグループ(通称,OilRig)による中東政府を標的とするサイバー攻撃のC2通信\cite{bondupdater}として実際のインシデントなどがある．
%このDNS Tunnelingのメカニズムは，スタブリゾルバからリカーシブサーバを経由し権威サーバへ問い合わせる一連の正規の仕組みに基づいており，名前解決を実現するにあたり生じる設計上の脆弱性を突いた手法である．
従来のDNS Tunnnlingに対するアプローチには，検知による手法が採用されてきた．
DNS TunnelingによるDNSクエリは，以下(\ref{eq:sample_qname})に示すように，転送量に比例して長いラベルを持ち，ラベルとしての文字列制約を満たすためのエンコーディングによって高いエントロピーを示す特徴がある．

\begin{eqnarray}
 \label{eq:sample_qname}
 \begin{aligned}
  &obqxg43xmqytcmjr.exfil.com\\
  &base32(password1111) = obqxg43xmqytcmjr
 \end{aligned}
\end{eqnarray}

また，インタラクティブなシェルなど双方向の通信をDNS Tunnelingで実現しようとする場合，時間あたりに高頻度なトラフィックが発生するという特徴が現れる．
このような特徴に基づき，パターンマッチングや機械学習，文字列分布などのメソッドを用いた検知手法が過去に多数考案されてきた~\cite{born, cheng, liu, asaf, steadman, jawad}．
それら検知手法は，かなり高い精度で分類を実現しているものがあるが，DNS Tunnelingとして検知する対象としているパケットには一般に利用することができるDNS Tunnelingツールキット~\cite{ozymandns, iodine, dnscat2}が使用され，それらは特に過剰な特徴量を示し，明らかに正規のDNSクエリと異なる特徴がある．
高い精度を示す従来の検知手法だが，しかし，それらを迂回する手法として，1回あたりの転送データ量を少なくすることで特徴量を減らすLow Throughputなバイパス手法，また，パケット間のインターバルを数日・数ヶ月と長期化させることでファイル肥大から一定期間しか保存されることがないログ管理の隙間を突いたSlowなTunenling手法があり，従来の検知手法では対応することが困難である．
悪意を持つユーザの視点として，1bitでも転送できることは秘匿通信として利用することができるため，転送量の少なさは軽視されるべきではない．

他方で，DNSは初めに述べたように，現在のインターネットの根幹技術として根ざしており，抜本的な改変は期待されない．
すなわち，既存のDNSによる名前解決のメカニズムに大幅な改変を加えないという制約下で，Tunnelingに対処することが現実的な最適解であると考える．


\subsection{目的}
本研究では，既存のDNSの名前解決メカニズムの大部分を流用することが一部の改変に留めながら，DNSを用いたデータ転送としての機能の排除を実現する次世代の名前解決メカニズムを提案する．
%\subsection{貢献点}
%本研究の貢献は，以下の通りである．
%\begin{itemize}
% \item 侵入通信を目的とするDNS Tunnelingに対するリアルタイム検知アルゴリズムの提案
% \item 既存対策アプローチとDNSの潜在的データ転送脅威モデルの検討
%\end{itemize}
%\subsubsection{脅威モデル}
%\subsubsection{仮説}




\subsection{本論構成}
%\ref{kako}節では、過去における研究について述べ、
%\ref{kadai}章では、現状と今後の課題について述べる。
%また、付録\ref{omake1}におまけその１を添付する。
本稿の構成は以下の通りである．
まず第２章で，準備として，DNSプロトコル・秘匿通信・Tunnelingメカニズム・分散データベースの4点について説明する．
第３章では，関連研究としてトラフィックおよびペイロード特徴に基づいた検知手法を説明し，それら手法がLow Throughput手法・Slow Tunneling手法に対して検知が困難であることを説明する．
第４章で提案手法とその実装について述べ，第５章で提案手法の性能評価と考察行い，第６章で残留する脅威モデルについて議論する．
最後に，第７章で結論と今後の課題について述べていく構成になっている．
