\section{提案システム}
本章では，DNSトンネリングの発生抑止を目的に設計した名前解決システムDNS-TD(DNS for Tunneling Deterrence)を説明する．
\begin{figure}[h]
 \centering
 \label{fig:abstruct-DNS-TD-architecture}
 \includegraphics[scale=0.6]{figure/new-architecture-DNS-TD.png}
 \caption{提案システムの概略図}
\end{figure}
\subsection{概要}
\label{sec:DNS-TD}
現在のDNSの名前解決の仕組みにおいて，名前空間が委譲の仕組みに基づきドメインごとにゾーンで分割されているため，名前解決クエリは目的ドメインの権威サーバまで転送される必要がある．
また，リソースレコードはドメイン名に関係ない任意の情報を関連づけることができる設計になっている．
この2つの特性に起因して，DNSトンネリングは機能する．
すなわち，再帰問い合わせに基づく名前解決の仕組みとドメイン名に関連づけるレコード情報に高い自由度を排除することによって，DNSトンネリングの発生抑止を実現することができる．
一方で，名前解決システムとしての機能を維持するために，以下に示す2つの性質を満たす必要がある．
\begin{description}
 \item[名前解決]\mbox{}\\ ドメイン名にIPアドレスなどの情報を関連づけることができ，それを解決することができる
 \item[スケーラビリティ]\mbox{}\\ ドメイン名の増加および関連づけられるレコード情報の増加に対応することができる
\end{description}
%%設計要件
以上から，期待される名前解決システムの要件は，上記2つの性質を満たしながら先の特性を排除することである．
そこで，提案システムDNS-TDでは，不足が無視できる程度に大規模の名前空間と範囲に基づくゾーン分割によって名前解決とスケーラビリティを実現し，再帰問い合わせの特性を排除させ，認証システムによってリソースレコードの自由度を下げることで上記の要件を満たす．
以降では，その要件を満たすための手法および仕組みを概観する．\newline

\textbf{不足が無視できる程度に大規模の名前空間}\\
DNS-TDは，ドメイン名とレコード情報の組みには識別子を付与され，この識別子は672bit(84bytes)の有限名前空間上の一意に写像されたものを使用する．
識別子は，ドメイン名とそのレコードタイプの文字列和をメッセージとするハッシュ関数から算出されるダイジェストである．
例えば，ドメイン名が``www.example.com"でレコードタイプが``A"のペアを考える．
この場合，メッセージが``www.example.comA"，識別子がこのメッセージをハッシュ関数に与えたダイジェスト``例:86ff(...中略...)8485"となる．\newline

\textbf{範囲に基づくゾーン分割}\\
識別子の名前空間について，ソートされた空間の特定範囲に基づいてゾーンが分割される．
提案システムにおけるサーバは，このようにして分割されたゾーンをそれぞれ担当することによって，分散的な管理システムとして協調することで名前解決機能を実現する．
提案システムにおけるサーバ機能は，一部を除いた\footnote{ccTLDとブランドTLDはSLDとして扱われ，それぞれ``cc"と``brand"というTLDに接続される．}gTLDによって集約される．
すなわち，SLD以降の権威サーバにサーバ機能はなく，ドメイン名とレコードタイプの作成と更新の機能のみを担う．
既存のSLD以降の権威サーバは，gTLDサーバにドメイン名の階層構造の序列を維持した状態で連結し，コンテンツ情報の操作を通じてgTLDにサーバ機能を委任する．
このように既存システムの権威サーバの機能を，サーバ機能とコンテンツ作成などの操作機能に分類することによって，クライアントからの権威サーバへの透過性を防ぎ，DNS Exfiltrationを抑止する．\newline

\textbf{認証システム}\\
DNS-TDでは，認証の仕組みを導入することでレコード情報の真正性を確保する設計をとっている．
既存システムでは，ドメイン名に関連づける情報はゾーンファイルにて定義されるが，ゾーンファイルを編集する主体が権威サーバであるため任意の情報を含めることができる設計になっている．
提案システムでは，先に述べるようにコンテンツの管理機能と編集機能とを分離させる．
コンテンツの編集機能は，サーバに階層的に接続されるノード，プロバイダが担う．
プロバイダを起点として行われるコンテンツへの操作は，認証機関を介在した後でサーバで実行される設計になっている．
この認証プロセスでは，依頼者(プロバイダ)情報およびレコード情報とその関連先となるドメイン名について真正性について検証される．
例えば，アドレスなどの情報であれば接続性が検証され，その他の情報であればレコード情報をドメイン名に関連づける正当性などが検証される．
この認証プロセスをパスし，証明書が発行されたコンテンツのみが，サーバによって管理される．
この認証プロセスによって，不審な情報がドメイン名に関連づけられることを未然に対処する．

以降では，上記3つのアプローチについて詳細に説明する．
また，DNS-TDで使う用語を表~\ref{tab:refres-terminology}にてまとめて示す．
\input{table/refres-terminology.tex}


\newpage
\subsection{システムアーキテクチャ}
\label{sec:system-architecture}
本節では，DNS-TDのシステムアーキテクチャについて説明する．
現在，DNSはインターネットの根幹に位置づく技術であり，ほぼ全てのクライアントノードは既存システムが提供するアーキテクチャおよびプロトコルに依存している背景がある．
このため，システムのアーキテクチャの再構成において，エッジノードに対して変更が加えられるのは，導入負荷が高くなることが予想される．
現在のDNSによる名前解決は，フルサービスリゾルバを介在させながら，スタブリゾルバをクライアント，権威サーバをサーバとするクライアントサーバアーキテクチャで構成されている．
DNS-TDでは，導入フェーズで予想されるクライアントに対する名前解決処理システムの負荷を軽減することを目的として，従来同様のクライアントサーバアーキテクチャを踏襲する．
サーバ群は，図~\ref{fig:system-architecture}で示すように，相互で接続されたフルメッシュなネットワークで構築される．
\begin{figure}[htbp]
 \centering
 \includegraphics[scale=0.5]{figure/system-architecture.png}
 \caption{DNS-TDにおけるクライアントサーバアーキテクチャ}
 \label{fig:system-architecture}
\end{figure}
%クライアントからクエリは，フルサービスリゾルバを経由したのち
%コンテンツは，そのコンテンツIDとそのマネージャのゾーンを対応づけた対応表に基づいて一意に担当する
%各サーバは，コンテンツをそのコンテンツIDに基づいて分散的にかんりする
%クライアントからのクエリがあった際には
%コンテンツを分散的に管理しクライアントからのクエリに応答する．
%DNS-TDにおけるドメイン名の名前空間も既存システム同様に階層的な構造で構成されるが，サーバ

\subsection{サービスノード}
本節では，DNS-TDにおける各サービスノードの機能と他のサービスとの関わりについて詳細に説明する．
DNS-TDの名前解決ネットワークにおいて，クライアントがスタブリゾルバ，サーバの機能はマネージャが担当する．\newline

\hspace{-12pt}\textbf{スタブリゾルバ}\\
\hspace{12pt}スタブリゾルバは，既存システムと変わらない．
これは第~\ref{sec:system-architecture}節で述べるように，名前解決の仕組みの変化に伴ってクライアントに接続障害が発生する可能性がある．
既存のDNSに依存したクライアントの存在を踏まえて，接続性に影響を与えないためにスタブリゾルバは現行通りの方法で目的のリソース情報を解決することができる設計になっている．
すなわち，スタブリゾルバは，IPアドレスをはじめとしたオブジェクトに関連づけられたレコード情報を問い合わせ，目的サービスを提供するサーバのリソースにアクセスするクライアントノードである．
既存システム同様，スタブリゾルバのクエリはフルサービスリゾルバに転送され，キャッシュにヒットした場合には即座にレコード情報の応答結果を取得する．
ヒットしなかった場合には，フルサービスリゾルバがスタブリゾルバに変わって，サーバにクエリを転送し，応答結果をスタブリゾルバに返す．\newline

\hspace{-12pt}\textbf{マネージャ}\\
%具体的なTLDについてしっかりこのセクションで説明するべき
%マネージャの数
%プロバイダからの応答について説明するべきか
\hspace{12pt} マネージャは，2つの機能を担うサービスノードである．
それは，クライアントからの問い合わせに応答する機能と他のマネージャに操作リクエストを転送する機能である．
マネージャは，既存システムにおける権威サーバから分離した機能の一部であり，その残りの機能はプロバイダが担当している．
はじめに，マネージャとドメインおよびプロバイダの関係について説明する．

DNS-TDでは，既存のドメインの階層構造は引き継がれ，マネージャ・プロバイダそれぞれが独自のドメインを持っている．
プロバイダは，マネージャと親子関係にあるノードであり，マネージャが上位ドメイン，プロバイダが下位ドメインという構成である．
マネージャは，既存システムにおけるTLDに相当するドメインを保持する．
現在，TLDには国や地域に割り当てられるccTLDと分野別のgTLDの2つに大別することができる．
DNS-TDでは，コンテンツはそのIDに基づき管理する主体が決定する．
このため，ccTLDがマネージャである場合，国家間が抱えるナショナリズムや政治に起因して，名前解決システムの全体の運用に支障を来す事態が発生する可能性がある．
このことを回避するために，DNS-TDの設計ではマネージャが保有できるTLDをgTLDに限定している．
ccTLDは，``country"をドメインに持つマネージャにサーバ機能を委譲し，プロバイダとしてレコード情報の操作を行うことで現在のTLDと同等の位置づけを保つ．
これは，ドメインが``jp.country"となるのではなく，サーバ機能を``country"をドメインに持つマネージャに委ねるということである．
他方で現在，gTLDにはコミュニティ以外に``google"をはじめとした企業TLDがある．
先の国や地域に基づくシナリオであったように，民間企業の勝手な判断でインターネット全体に影響が波及するような接続性の断絶は起きうる．
そこで，企業やブランドを表すTLDは，``brand"というドメインにもつマネージャにサーバ機能を委譲し，プロバイダとして存在を継続させる．
その他のクラスとして分類することが困難な``foo"といったTLDについては，``misc"というドメインに持つマネージャにサーバ機能を委譲させる．
このように，DNS-TDでは，ドメインの名前空間を継続しながら，サーバとしての機能を再定義する．

以上のことを踏まえて，マネージャの機能について説明する．
1つ目は，ドメイン名とそれに関連づけられたレコード情報を保持し，フルサービスリゾルバからの問い合わせに応答する機能である．
マネージャは，レコード情報を管理するためにデータベースを用いる．
マネージャが保持するコンテンツは，そのドメイン名とレコードタイプによって決まる．
必ずしも自身のドメインを含むコンテンツを保持するわけではない．
例えば，``www.example.com"のAレコードについて考える．
この組のコンテンツIDが``47d8(中略\footnote{224bitのハッシュ値を表す．})cb6"であるとする．
他方で，``com"マネージャのゾーンは，``a000(中略)000"から``bzzz(中略)zzz"を担当しているとする．
また，``org"マネージャが``4000(中略)000"から``5zzz(中略)zzz"を担当しているとする．
この時，``www.example.com"はcomというTLDをもつが``com"マネージャではなく，``org"マネージャが保持する．
このようにして，コンテンツの管理は，ドメインに基づいて管理されるのではなくコンテンツIDの値とハッシュ値の範囲に基づいて決まる．

\input{table/discription-manager}
\newpage
\input{algorithm/name-resolution}
2つ目は，プロバイダからコンテンツに対するの操作リクエストを受け付け，コンテンツIDを算出し担当のマネージャに操作リクエストを転送する機能である．
フルサービスリゾルバから問い合わせが発生した際，はじめにアルゴリズム~\ref{algo:manager}で示すようにクエリパケットからコンテンツIDを取得する．
次に，レコード情報を取得するために，コンテンツIDをキーとしてデータベースから対応するコンテンツを探索する．
コンテンツの存在の有無に従い，存在した場合にはレコード情報が応答され，実在しなかった場合には不在として応答される．
\input{algorithm/registration-handler}

\newpage
\hspace{-12pt}\textbf{フルサービスリゾルバ}\\
\hspace{12pt}フルサービスリゾルバは，サーバからの応答をキャッシュするを持つサービスノードである．
また，コンテンツIDおよびドメインIDを算出し，コンテンツを保持するマネージャに問い合わせる機能を担う．
全てのフルサービスリゾルバは，マネージャとそのマネージャのゾーンに関する対応表のファイルを保持している．
この対応表は，ICANNから提供される``Root.hints"ファイルのようにウェブ上で公開され，入手することができる．
フルサービスリゾルバは，アルゴリズム~\ref{algo:full-service}で示すように，スタブリゾルバからのクエリに含まれるドメイン名とレコードタイプに基づきコンテンツIDとドメインIDを導き出す．
コンテンツを保持するマネージャは，コンテンツIDが含まれるゾーンを探索することで一意に決定される．
名前解決には，``コンテンツID.ドメインID"のようにドット区切りでIDを組み合わせたものを識別子としてマネージャに問い合わせる．
レコード情報もしくは不在情報に関する応答パケットをマネージャから受け取ると，フルサービスリゾルバは既存システム同様に応答情報をキャッシュした後，スタブリゾルバに応答する．
\input{table/discription-query-handler}
\input{algorithm/name-hashing}

\newpage
\hspace{-12pt}\textbf{プロバイダ}\\
%マネージャとのどのような階層構造なのか
%どのようなプロトコルでパケットをマネージャに転送するのか
\hspace{12pt}プロバイダは，既存システムの権威サーバの機能のうち，レコード情報を操作する機能を担当するノードである．
すなわち，既存システムのSLD以降のドメイン情報に関して，作成・更新および消去といったレコード情報の操作を担当する．
メインの階層構造に上位のドメインを保持するマネージャが，プロバイダが保持するドメインのサーバ機能を担当する．
プロバイダは，認証局にてコンテンツ情報の真正性を評価されたのちに，プロバイダの上位に位置づくマネージャがそのコンテンツを担当するマネージャに依頼することでレコード情報を操作する．
例えば，example.comプロバイダが``www"のIPアドレス情報を作成することを考える．
example.comプロバイダは，``www.example.com"とレコードタイプ``A"およびその値``93.184.216.34"を含むデータを接続先のcomマネージャにリクエストする．
comマネージャは，リクエストされたドメイン名とそれに関連づけるレコードタイプから識別子を算出し，担当のマネージャにストアリクエストを転送するという具合で動作する．
%\input{algorithm/provider}


% 認証局を導入するとインターネットの匿名性を実現することが難しくなるのではないか
% レコード情報に認証局を導入する場合，webなどのサービスやコンテンツを提供するのが少し困難になるではないかという懸念
% githubなどにおいては，同一ドメインにファイルという形でユーザにディスクを提供している
% CAを委譲する仕組みがある．これによって，
\hspace{-12pt}\textbf{認証局}\\
\hspace{12pt}認証局は，レコード情報の真正性を検証するプロバイダとマネージャの中間に位置づく，信頼された第3者機関である．
DNS-TDでは，全てのコンテンツについて，信頼される第三者からストアしても良いと認可されていることを前提としている．
すなわち，ハッシュテーブル上のコンテンツへの操作，またはコンテンツをハッシュテーブル上にストアするなどの操作処理をする際，プロバイダは，信頼される第三者からのレコード情報に操作することを認可してもらう必要がある．
認可の証明書を発行する認証局は，プロバイダの基本情報とレコード情報に基づき証明書の発行を決定する．
いま，ドメイン名``www.example.com"のリソースレコードタイプAとして``93.184.216.34"というレコード情報を関連づけるとする．
プロバイダは，認証局に対して証明書発行リクエストを転送する．
認証局は，リクエストされたレコード情報についてIPアドレスの到達性と不審な文字列が含まれていないこと，利用目的について評価を施す．
認可された場合には，その証にディジタル証明書を発行し，マネージャにストアリクエストを転送する．
マネージャは，ディジタル証明書に付与された署名に基づきコンテンツの完全性を評価し，認証された場合コンテンツIDを計算し，担当マネージャにストアリクエストを転送する．
上記の手続きを経たコンテンツがハッシュテーブル上にストアされる．
\begin{figure}[h]
 \centering
 \includegraphics[scale=0.7]{figure/certificate-procedure.png}
 \caption{レコード情報操作におけるプロセスの概略図}
 \label{fig:manager-provider}
\end{figure}


\newpage
\subsection{識別子}
%ハッシュ空間によってIDが管理されることとどのハッシュ関数を使用するのかを説明する．
本節では，レコード情報にアクセスするために用いる識別子について説明する．
DNSにおける名前解決では，ドメイン名とレコードタイプの情報をサーバに問い合わせ，サーバは保持するゾーンファイルから該当するレコード情報が応答される仕組みになっている．
他方，DNS-TDでは，ドメイン名とレコードタイプに基づき算出されるコンテンツIDとドメインIDを識別子としてサーバに問い合わせ，サーバは識別子をキーとする対応するバリューを応答させることで名前が解決する仕組みになっている．
ドメイン名とレコードタイプの全ての組み合わせをフラットな名前空間上に対応づける設計において，名前空間の大きさは数の不足を無視できる程度に大きくなくてはならない．
既存のDNSのプロトコルフォーマットが広く一般化している点に留意し，提案システムではプロトコルへの変更を加えない設計デザインに思想としている．
このため，既存のDNSのQuestion Sectionなどにおけるサイズの制約を満たす必要がある．
ドメイン名が格納されるQnameは，255bytesである．
また，DNSのラベルの最大長は63bytesである．
この識別子は，ドメイン名とレコードタイプをメッセージとするハッシュ関数から算出されるメッセージダイジェストである．
コンテンツIDは，ドメイン名とレコードタイプの文字列の和を引数とするメッセージダイジェストである．
ドメインIDは，ドメイン名を引数とするメッセージダイジェストである．

%以上のことから，84bytesの名前空間をDNS-TDでは採用する．
% 84bytesの名前空間を持つこととダイジェストの長さは違う
% sha3_224のダイジェスト長は，56文字

\subsubsection{ハッシュアルゴリズム}
本項では，コンテンツIDとドメインIDに使用されるハッシュアルゴリズムについて詳しく説明する．
DNS-TDで使用するハッシュアルゴリズムには，以下のような制約がある．

\begin{enumerate}
 \item 名前空間は不足を無視できる程度に大きくなくてはならない
 \vspace{-3mm}
 \item アルゴリズムは一方向性の性質を備えなくてはならない
 \vspace{-3mm}
 \item ラベル長は最大63byte，ドメイン長は最大253byteである
 \vspace{-3mm}
\end{enumerate}

ドメイン名とリソースレコードタイプの組をハッシュ値の引数とするため，コンテンツIDは，レコード情報の数に比例して増加する特性がある．

また，識別子の引数の一つにドメイン名が含まれていることから，識別子から元のメッセージが導き出くことが困難な性質を備えていなくてはならない．
この性質を満たすことで，なんらかの方法で識別子を悪意の第三者が取得された際にDNS Exfiltrationとしてデータを転送されることを抑止することができる．
%ここで，既存のハッシュ関数の特性をまとめたtableを示す．
以上から，DNS-TDでは，56byteの名前空間をもつsha3のアルゴリズムを採用する．

メッセージダイジェストは，コリジョンが無視できる程度に大きな名前空間と分布を備えたハッシュ関数を備えなくてはならない．
以降では，コリジョンが発生した対処法として採用する分離連鎖法と2重ハッシュ法について説明する．
DNS-TDでは，コンテンツのストアリングフェーズでIDにコリジョンが発生した場合，分離連鎖法に基づきストアされるハッシュテーブルに連結リストという形式でコンテンツがストアされる．
リスト構造で延長するコンテンツの識別には，ドメインIDを識別子として利用する．
ドメインIDは，コンテンツIDと同様のハッシュアルゴリズムを用いて算出されるメッセージダイジェストの先頭32bitで表現される，ドメイン名を引数として生成される識別子である．
例えば，ドメイン名を``www.example.com"とする場合，そのメッセージダイジェストが``86ff20100c058b857bae9785bf0267e6c6afb740c18b8e9a87258485"であるとすると，``86ff20100c058b857bae9785bf02"がドメインIDとなる具合である．
このように算出されたドメインIDは，DNSのQuestion Sectionのうち，それぞれ16bit分の領域を持つタイプとクラスの領域に埋め込まれる．
上記の仕組みによって，コリジョンが発生した際には，ドメインIDをキーとしてコンテンツを識別する．

メッセージダイジェストの出力長はそれぞれ，コンテンツIDが56byte，ドメインIDが28byteである．
ここで，ドメイン名が``www.example.com"でAのレコードタイプの組み合わせを考える．
コンテンツIDは，``www.example.comA"のように文字列和をメッセージとする．
ドメインIDは，ドメイン名``www.example.com"がメッセージとなる具合である．

\subsubsection{ゾーン分割}
本項では，ゾーンの分割方法およびマネージャノードのアドレスとそのゾーンの範囲に関する対応表について説明する．
はじめに比較のために，従来のシステムの場合について説明する．
従来のシステムでは，ドメインの階層構造に従い，ドメインの管理ノードを下位のドメイン管理ノードに委譲することでゾーンが分割される．
この仕組みでは，ゾーン内の全てのレコード情報はゾーンファイルに画一的にまとめられ，そのゾーンを管理する権威サーバがレコード情報の保持機能とクライアントから応答するという二つの機能を担う．
このゾーン分割メソッドでは，レコード情報の帰属が明確であり，ドメインの管理ノードがトラストアンカーとしての役割を同時に担うことができるメリットがある．
一方のDNS-TDでは，識別子を算出する際に使用するハッシュ関数によって構成される名前空間に基づき，ソートされたハッシュの名前空間の連続した範囲で分割する．
この分割された連続した範囲に基づきゾーンがマネージャに割り当てられることで，既存システム同様にレコード情報全体を分散的に管理する．

上記で説明するように，マネージャが管理するゾーンは，ハッシュの名前空間の連続した一部の範囲である．
従って，レコード情報は，ハッシュの名前空間上で識別子をソートした際に，帰属する範囲を管理するマネージャによって保持される．
マネージャのアドレスを解決する方法には，ゾーンとしてハッシュ値の範囲とそのマネージャおよびマネージャのアドレスに関する対応表~\ref{tab:hash-management}によって解決される．
DNS-TDでは，全てのサービスノードがこの対応表を保持できることを想定しており，ノードは識別子に基づきどのマネージャがコンテンツを保持しているのかを一意に特定する．
\input{table/managemnt_range}

\newpage
\subsection{リソースレコード}

\subsubsection{レコードタイプ}
本項では，DNS-TDで使用するリソースレコードのタイプについて説明する．

% 提案システムで使用するレコードタイプを概観するか，もしくは既存システムにおけるリソースレコードのタイプの課題から説明するのがいいだろう
はじめに，DNS-TDにおけるDNSSECの位置づけについて述べる．
DNSSEC~\cite{rfc4033}は，権威サーバからの応答パケットの偽装を検知することを目的として，データの作成元の確認とデータの完全性および，不在情報応答情報の証明するDNSの拡張仕様である．
これは，主としてDNSの応答パケットを偽装できる程度のパラメータであることに起因する．
他方で，DNS-TDでは，応答パケットに224bitのメッセージダイジェストが含まれるため，悪意のある応答パケットをフルサービスリゾルバに意図的にキャッシュすることは極めて困難である．以上の理由から，DNS-TDではDNSSECの目的にそぐわないため，リソースレコードとして使用されない．

次に，DNSSEC以外のリソースレコードについて説明する．
第~\ref{sec:dns-infiltration}項で示すように，既存の名前解決システムでドメインに関連づけることができるリソースレコードのいくつかのタイプは，DNS Infiltrationとして機能することができる．
DNS Infiltrationを抑止するリソースレコードであることの必要条件は，ドメインに関連のない任意の文字列がレコード情報に含められないことである．
既存のDNSのリソースレコードのタイプのうち，任意の文字列を含めることができるのタイプは以下の通りである．

表~\href{tab:infil-rtype}のDNS Infiltrationとして機能する可能性のあるリソースレコードのタイプのうち，IPアドレスを偽装して情報を転送するものについては，第~\ref{sec:certificate}項で述べた認証基盤によってレコード情報の正当性評価で排除することができる．
NULL・TXT・CNAMEのレコードタイプも認証基盤における正当性の評価に基づいて，目的にそぐわない内容を含む場合には署名の作成を破棄することでDNS Infiltrationの発生を抑止する．

%NULLについて考える．
%NULLタイプの目的は，実験用と定義されている~\cite{rfc1035}．
%TXTについて考える．
%CNAMEについて考える．
%ホスト名に対する別名で関連づけることができるCNAMEは，一つのサーバにおいてサービスごとにサーバの名前を変更させるために使用される．
%DNS-TDでは，ドメインごとにゾーンは保持しないので

% データベースについて
% Redisについて説明

%\subsection{データベース}
\subsubsection{コンテンツのデータフォーマット}
本項では，マネージャにて管理されるコンテンツのフォーマットについて説明する．
マネージャに保持されるコンテンツは，図~\ref{fig:manager-provider}に示すようにデータフォーマットで管理される．
認証済みのコンテンツは，マネージャに転送された後，コンテンツIDをキーにドメイン名やレコードタイプなどの情報をバリューとしてデータベースで管理する．
データベースには，永続性と高速な読み書きを実現するインメモリのRedisというNoSQLのデータベースを用いる．

\begin{figure}[h]
 \centering
 \includegraphics[scale=0.6]{figure/content-file.png}
 \caption{コンテンツのデータフォーマット}
 \label{fig:manager-provider}
\end{figure}

%\subsection{動作メカニズム}
%\subsubsection{レコード情報に対する操作}
%本項では，DNS-TDにおいて使用されるリソースレコードのタイプと
%%TTLの更新方法について説明する
%
%\subsubsection{名前解決}
%ハッシュテーブルのレプリケーション手法
%特定のハッシュ範囲を管理するノードは，複数用意させ，そのアドレスを対応表に明記し，ストアする際にその全てのレプリケーションサーバにストアリクエストする
