\section{評価}
\label{sec:evaluation}
本章では，提案システムのDNSトンネリング抑止の機能としての効果について，実装したプロトタイプ実装上で擬似トンネリング通信の動作させることによるシミュレーションテストに基づき明らかにする．
次に，提案システムの特性についての要件に基づき評価した結果を示し，トラフィック量の削減と高速な名前解決システムとして有用であること明らかにする．
特性評価には，次世代ネットワークとして提案されているICN(Information-Centric Networking)\footnote{ICN : サーバ指向のネットワーキングではなくコンテンツ指向のネットワーキング．}の名前解決システムの要件として議論されているインターネットドラフトを用いて評価を行った~\cite{irtf-icnrg-nrs-requirements-03}．
当該要件は，一つ目の``ICNにおける名前解決機能"は明らかにICN固有の要素であるのに対して，その他のガイドラインとセキュリティに関する事柄は，名前解決システムの要件として一般化できる内容であると考えられる．
ICNの名前解決システムには，以下のような項目が要件として定められており，翻訳したものを以降で示す．
%本研究では，さらに名前解決に伴うトラフィック量についても評価の項目に含めた．

\begin{description}
 \item[ICNにおける名前解決機能]\mbox{}\\
	 \vspace{-9mm}
	\begin{enumerate}
   \item スケーラブルなルーティングシステムのサポート
	 \vspace{-3mm}
	 \item オフパスキャッシュ機能のサポート
	 \vspace{-3mm}
	 \item 名前なしオブジェクトのサポート
	 \vspace{-3mm}
	 \item マニフェストのサポート
	 \vspace{-3mm}
	 \item メタデータのサポート
	\end{enumerate}
 \item[ICNにおける名前解決の設計ガイドライン]\mbox{}\\
	 \vspace{-9mm}
	\begin{enumerate}
	\item 名前解決速度
	 \vspace{-3mm}
	\item 応答の正確性
	 \vspace{-3mm}
	\item 名前解決の保証
	 \vspace{-3mm}
	\item 公平な名前解決
	 \vspace{-3mm}
	\item スケーラビリティ
	 \vspace{-3mm}
	\item 管理のし易さ
	 \vspace{-3mm}
	\item 配備されたシステム
	 \vspace{-3mm}
	\item 故障耐性
  \end{enumerate}
 \item[セキュリティに関する事柄]\mbox{}\\
	 \vspace{-9mm}
	\begin{enumerate}
   \item 可用性
	 \vspace{-3mm}
	 \item 認証
	 \vspace{-3mm}
	 \item データの機密性
	 \vspace{-3mm}
	 \item プライバシーの保護
	 \vspace{-3mm}
	 \item ロバストネス・レジリエンス
	 \vspace{-3mm}
	 \item ネットワークプライバシー
	\end{enumerate}
\end{description}


%提案システムでは，DNSトンネリング抑止の目的に対して，フラットな名前空間とDHTの仕組みを採用している．
%このアプローチは，名前解決のパフォーマンスにおいて，コンテンツの識別子に用いられるメッセージダイジェストの算出に伴うメモリ消費と問い合わせノードの探索の処理がオーバーヘッドになることが予想される．
%本章では，DNSトンネリング抑止としての提案システム設計の有用性と提案システムの特性について評価した結果を述べる．
%%フラットな名前空間とDHTに基づき分散的な管理する提案システムが，DNSトンネリング抑止に対して有効であることを明らかにする．
%評価では，提案システムのプロトタイプを実装することで，シミュレーションに基づいて評価を行った．
%
%トンネリング抑止の機能評価テストでは，フルサービスリゾルバとマネージャおよびプロバイダをPython3を用いて実装し，それらサービスをDockerのコンテナとして動作させることによって，提案システムにおける名前解決環境を再現したプロトタイプを用いた．
%また，DNSトンネリングの通信には，ランダムなドメイン名をdigコマンドを用いることによって再現した．
%プロトタイプ上におけるdigコマンドによる擬似トンネリング通信について，プロバイダにデータが転送されないことを確認する．
%特性評価では，ランダムな名前解決クエリを用意し，既存のDNSと提案システムの両方で問い合わせた際のトラフィックと名前解決の速度について，統計的に評価を実施する．

\subsection{プロトタイプ実装とシミュレーション環境}
\label{sec:simulation}
%ここではプロトタイプ実装とネットワーク環境を説明すればいい
提案システムのトンネリングの抑止機能の評価には，Dockerによる仮想環境上でシミュレーションテストに基づいて行った．
マネージャやフルサービスリゾルバなどの各サービスノードをPython3を用いて実装し，プログラムを各dockerコンテナとして動作させることによって，擬似的に名前解決基盤を構築した．
プロトタイプの実装には，主としてDNSの機能を提供するdnslibを用いた~\cite{dnslib}．
dnslibは，DNSクエリパケットのパース機能とDNSパケットを作成するのに用いた．
また，マネージャにおけるコンテンツの管理には，データベースを用いている．
データベースには，インメモリで永続性機能を持つRedisを使用した．
\input{table/software_version.tex}
%なぜRedisなのか
%提案システムにおいて，データ管理として求められる要件は，コンテンツの永続性である．
%レコード情報はドメインIDとコンテンツIDという識別子によって関連づけられている．
%クライアントは，レコード情報を識別子として指定することで，関連づけられたデータを取得できるという設計である．
%これは．KVSと呼ばれるデータ管理モデルと一致する．
%すなわち，Keyを
%Docker内部におけるネットワーク構築

次に，Docker環境上に構成したネットワーク構成について説明する．
組織内においては，OP53Bが適用されており，スタブリゾルバからの名前解決には内向きのフルサービスリゾルバのみが使用されるものとしている．
フルサービスリゾルバは，組織外のネットワーク(インターネット)に設置されたマネージャに接続されている．
図~\ref{fig:exp-network-topology}に示す通り，提案システムではルートを経由した再帰問い合わせではなく，コンテンツを保持するマネージャとフルサービスリゾルバは直接接続される．

\begin{figure}[h]
 \centering
 \includegraphics[width=14.5cm]{figure/exp-network-topology.png}
 \caption[実験に用いたネットワークトポロジー]{Docker環境内におけるネットワークトポロジー}
 \label{fig:exp-network-topology}
\end{figure}

\newpage
\subsection{提案システム上でのDNSトンネリング}
\label{sec:eval-tunnel}
本節では，提案システムにおけるDNS Exilfiltration抑止機能について，擬似DNSトンネリングの通信を提案システム上で発生させるシミュレーションに基づいて評価した結果を示す．
シナリオは，DNS Exiltrationの手法に基づいて，スタブリゾルバから``exfil.com"を宛先にDNSクエリが発せられることを想定する．
擬似的なDNSトンネリングの問い合わせに用いるドメイン名には，1文字から63文字の間の長さでランダムな文字列からなるラベルの集合として5000個を用意し，宛先が``exil.com"となるようにそのラベルをサブドメインとして組み合わせたドメイン名を作成した．
DNS Exfiltrationでは，問い合わせるリソースレコードのタイプの種類は問われないため，全てAレコードを設定した．
実験では，用意した5000個のドメイン名を問い合わせるスクリプトを用意し，スタブリゾルバから実行した．
図~\ref{fig:stab-fullservice}で示すように，クエリは既存システム同様に，組織内部のフルサービスリゾルバにはじめに転送される．
フルサービスリゾルバは，問い合わせられたドメイン名とレコードタイプからドメインIDとコンテンツIDを算出し，コンテンツを保持するマネージャのアドレスをコンテンツIDに基づいて決定する．
図~\ref{fig:fullservice-manager}で示すように，QuestionセクションのQnameには，識別子である``コンテンツID.ドメインID"が含まれている．

このような仕組みで，コンテンツを操作するプロバイダにはスタブリゾルバからのクエリは転送されず，スタブリゾルバとマネージャ間のトランザクションで完結する名前解決のメカニズムによって，DNS Exfiltrationとして機能できないことが確認できる．
%実際にコンテンツが登録されている場合とコンテンツ情報が含まれていない場合(DNSクエリ)
%擬似DNSトンネリングとするドメイン名については，過去の文字列分布が均等分布になることに基づいてランダムな関数で作成したこと理論について説明すること
%提案システム上で，iodineを動作させた際のパケットキャプチャーした様子を説明する

\begin{figure}[p]
 \centering
 \includegraphics[width=14.5cm]{figure/stab-fullservice.png}
 \vspace{-1cm}
 \caption{スタブリゾルバからフルサービスリゾルバにおける通信}
 \label{fig:stab-fullservice}
 \vspace{1cm}
 \includegraphics[width=14.5cm]{figure/fullresolver-manager.png}
 \vspace{-1cm}
 \caption{フルサービスリゾルバからマネージャにおける通信}
 \label{fig:fullservice-manager}
\end{figure}

\newpage
\subsection{特性}
提案システムは，既存システムと比較するとき，表~\ref{tab:diff_dns-td_dns}に示すような特性が現れる．
本節では，既存システムと比べて提案システムがトラフィック量が少なくなる点と名前解決の高速が期待される点について説明する．
また，ICNにおける名前解決システムの要件に基づき評価したそのほかの特性についても説明する．
\input{table/diff_dns-td_dns}

\subsubsection{トラフィック量}
%クエリminimizationがどの程度普及しているのかによって，計算方法が随分と異なることが予想される
%Query minimizationの場合は，どのようになるのか
表~\ref{tab:diff_dns-td_dns}で示すように，提案システムではサーバへの問い合わせは一回で済む．
DNSでは，コンテンツを保持するサーバまで再帰的に問い合わせることを踏まえると，提案手法の方がトラフィック数は少なくなることが予想される．
一方で，DNSは任意のドメイン名が使用されるのに対して，提案システムでは常に固定長の84bytesのドメイン名が使用される．
本項では，上記の違いに関して，それぞれシステムにおける名前解決で発生するトラフィック量を比較評価した結果を示す．

トラフィック量の評価においては，クエリパケットのみに焦点を当てた．
既存システムにおける再帰問い合わせでは，ルートからTLD，SLDと権威サーバのアドレスがAuthoirityセクションに含まれて応答されるが，ドメイン毎に権威サーバの数が異なる．
さらに，権威サーバのアドレスとして含めることができるアドレスは一つでないため，応答パケットのサイズにはドメイン毎にランダムである特性がある．
このように応答パケットのサイズはドメイン依存であるため推定することが困難である．
以上から，トラフィック量の推定には，クエリパケットのみを焦点に当てた．
また，既存システムと提案システムのスタブリゾルバからフルサービスリゾルバまでの通信は両者とも共通であるため，評価するトラフィックはフルサービスリゾルバとサーバ(権威サーバもしくはマネージャ)間の通信を評価した．
長さの異なるドメイン名として，1文字(ルート)から最大長の253文字まで全253種類のドメイン名を用意した．
評価では，長さの異なる253種類のドメイン名をスタブリゾルバからクエリし，フルサービスリゾルバから権威サーバ(提案システムではマネージャ)までのクエリパケットのサイズを対象とした．
既存システムでは，権威サーバへの問い合わせる方法には，2つの種類がある．
1つ目は，ルート権威サーバやTLD権威サーバ問わずにFQDNで問い合わせる方法である．
この場合，権威サーバを宛先とするパケットは，常に同じパケットサイズとなる．
2つ目は，Qname Minimization~\cite{rfc7816}と呼ばれる手法で，宛先となる権威サーバにはその次の権威サーバのドメイン名のみを問い合わせるという方法である．
Qname minimizationは，権威サーバに問い合わせるQuestionセクションのドメイン名が最小限に留められる．
例えば，``www.example.com"について考える．
フルサービスリゾルバにおいてQname minimizationの設定が有効になっている場合，ルート権威サーバには``com"のNSレコード情報が問い合わせられる．
同様にして，``com"権威サーバには，``example.com"のNSレコード情報が問い合わせられるという具合である．

はじめに，ルートのAレコードタイプに関するクエリパケットのサイズを収集した．
次に，全てのTLDのドメイン名を収集し，TLDのAレコードタイプに関するクエリパケットのサイズを収集した．
\input{table/root-tld-packet-size}
また，全てのドメインの長さパターンにおけるパケットサイズのデータを収集した．
Qname Minimizationを使用しない場合，名前解決に伴うクエリの総トラフィックサイズは，以下の計算式で求めることができる．
\begin{eqnarray}
 (n\ Label's\ Traffic) &=& (R + (Label\ Length) + r + Rtype + O) \times n\\
 &=& (1 + (label\ Length) + 1 + 1 + 68) \times n\\
 &=& (71 + (Label\ Length)) \times n
\end{eqnarray}

図~\ref{fig:length-size}が，DNSとDNS-TDにおける名前解決にて発生するクエリパケットの総トラフィック量の比較である．
x軸が，スタブリゾルバから問い合わせられたドメイン名の長さで，y軸が総トラフィック量である．

\begin{figure}[p]
 \centering
 \includegraphics[scale=0.8]{figure/length-size.png}
 \caption{DNS-TDとDNSにおける名前解決に使用されるクエリパケットサイズの比較}
 \label{fig:length-size}
\end{figure}

%  9: 243bytes
% 10: 246bytes

図~\ref{fig:length-size}から，Qname Minimizationを使用しない場合では，提案システムのような固定長の方が再帰的に問い合わせるよりもトラフィック量は抑えられることが確認できる．

%次に，Qname Minimizationが適用されている場合を考える．
%Qname Minimizationを使用する場合，名前解決時に必要となるそうトラフィックサイズは，以下の計算式から求めることができる．
%\begin{eqnarray}
% (n\ Label's\ Traffic) &=& (R + (Label\ Length) + r + O) \times n\\
% &=& (1 + (label\ Length) + 1 + 69) \times n\\
% &=& 71 \times (Label\ Length) \times n
%\end{eqnarray}
%

%以上の検証結果より，提案システムの方が既存システムと比べてクエリトラフィック量を抑えられることが確認できた．
%DNS-TDでは，シンボル志向の名前解決メソッドによって，既存の再帰問い合わせによるメソッドよりも少ないトラフィックに抑えることが期待される．

\newpage
\subsubsection{オーバーヘッド}
%提案システムにおいて，マネージャの機能は既存システムにおけるTLDの権威サーバが担当することを想定している．
%このため，提案システムでは，マネージャまでのトラフィック
%ハッシュ計算に伴うオーバーヘッドについて
提案システムの名前解決メカニズムでは，名前解決問い合わせの都度，コンテンツIDとドメインIDを算出する必要がある．
ハッシュ関数に基づいたこの2つの識別子を算出する処理は，名前解決処理におけるオーバーヘッドになることが予想される．
本項では，識別子の算出処理に伴う時間的なオーバーヘッドについて，検証実験に基づいて評価した結果を示す．

評価では，はじめに``exfil.com"を宛先とするランダムに作成した5000個のドメイン名とリソースレコードのタイプの組を用意した．
その組からコンテンツIDとドメインIDを算出するのにかかった時間の記録をとった．
この操作を4回繰り返し，組ごとのダイジェスト算出にかかった時間の平均をとったのが，表~\ref{fig:overhead}である．
処理時間を抽出には，Timeライブラリの``perf\_counter"メソッドを用いた．
検証環境は，表~\ref{tab:overhead-test}の通りである．

\input{table/overhead-test-evironment.tex}

図~\ref{fig:overhead}で示す検証の結果から，識別子の組を算出するのにかかる時間は約0.003ミリ秒の分布する．
名前解決にかかる時間は，ルート権威サーバを例にとると図~\ref{fig:root-rtt}で示すように，0から1000ミリ秒と振り幅はあるものの明らかに識別子にかかる時間は無視できる程度に小さいことが確認できる．
以上から，提案システムにおける識別子算出にかかる時間的オーバーヘッドは無視できるものと捉えられる．

\begin{figure}[h]
 \centering
 \includegraphics[scale=0.8]{figure/overhead.png}
 \caption{コンテンツIDとドメインID算出にかかる計算時間のオーバーヘッド}
 \label{fig:overhead}
\end{figure}
%処理にかかるメモリのオーバーヘッドについて


%DNSは，現在のインターネットの根幹に位置する技術であるため，DNSトラフィックはインターネット全体に大きく影響する．
\newpage
\subsubsection{名前解決速度}
\label{sec:resolution_speed}
提案システムでは，コンテンツを保持するサーバはコンテンツIDから一意に決まる．
一方，既存システムでは，ルートから階層的にコンテンツを保持するサーバを探索した後に決まるため，提案システムの方が高速に名前解決できることが期待される．
この特性を踏まえて，本項では，既存システムと比較した時の名前解決速度の差を示す．

名前解決速度の評価には，フルサービスリゾルバによる問い合わせに対する権威サーバからの応答までの時間に基づいて評価する．
提案システムにおいて，マネージャサービスは既存システムにおけるTLDが担当する．
% 既存のDNSにおけるラウンドトリップのうち，再帰問い合わせの最後の権威サーバRTTがdns-tdのフルリゾルバとマネージャのそれになる．
% 遠いものと近いもののRTTを用意する必要がある

\begin{figure}[h]
 \centering
 \includegraphics[scale=0.8]{figure/root-rtt.png}
 \vspace{-1cm}
 \caption{Root権威サーバにおけるRTTの分布}
 \label{fig:root-rtt}
 \includegraphics[scale=0.8]{figure/average_rtt.png}
 \vspace{-1cm}
 \caption{TLD権威サーバにおけるRTTの分布}
 \label{fig:tlr-rtt}
\end{figure}

%\subsubsection{評価項目に基づいた特性の評価}

% DDoSへの影響については，リクエストとレスポンスパケットのサイズからアンプ率に着目する
%DNS-TDでは，56byteを固定長とするコンテンツIDをシンボルとすることによって，レコード情報にアクセスする．
%この仕組みの影響で，DNS-TDのパケットは従来のパケットと比較して肥大する特性がある．
%このため，送信元を目的ホストと偽装することで目的ホストの計算リソースを圧迫するDDoS攻撃に対して，脅威を高める可能性が予想される．

% 比較項目
% 従来のドメインごとにゾーンが分離している設計と違い，一つのゾーンには様々な組織のドメインが管理されている．
% アンプ率は，既存のDNSと基本的に変わらない．DNSSECがあるかないかについて議論するくらい
